<!DOCTYPE html>
<html>
<head>
    <title>Webcam Emotion Detection</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Webcam Emotion Detection</h1>
    <div>
        <video id="videoElement" width="640" height="480" autoplay></video>
    </div>
    <div>
        <h2>감정 분석 결과</h2>
        <p id="resultElement"></p>
    </div>
    <script>
        // 웹 카메라에서 비디오를 가져올 수 있는지 확인하고, 비디오 요소에 연결합니다.
        navigator.mediaDevices.getUserMedia({ video: true })
            .then((stream) => {
                const videoElement = document.getElementById('videoElement');
                videoElement.srcObject = stream;
            })
            .catch((error) => {
                console.error('비디오를 가져올 수 없습니다:', error);
            });

        // 감정 분석 결과를 출력하는 함수
        function showEmotionResult(emotion) {
            const resultElement = document.getElementById('resultElement');
            resultElement.innerHTML = `감정: ${emotion}`;
        }

        // 비디오에서 프레임을 캡처하고, 감정 분석 결과를 받아와 출력하는 함수
        function captureFrameAndDetectEmotion() {
            // 비디오 요소와 캔버스 요소를 가져옵니다.
            const videoElement = document.getElementById('videoElement');
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            // 비디오 프레임을 캔버스에 그립니다.
            ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

            // 캔버스의 데이터 URL을 가져옵니다.
            const dataURL = canvas.toDataURL('image/jpeg');
          var api_key= {
  "type": "service_account",
  "project_id": "quantum-ether-381103",
  "private_key_id": "9f873825b56483f1786de3e5bcd19bdd82a008ae",
  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDqnJXOvyCN1303\ns0dypNu27FYFhuAy+l/p7pAIuMWRZ73BTtPrV+8Htmb8jNbyz17zxOjnC1+QMzA7\njSvR5rHwk2+kuMVkyQ3WeMImy5nT/vhy3T8BZ9LgbMSjYC2o+1AdOy7WWdOkUWWv\nGneVVipyklAXFHg0q0G2dVWbW1dmqqQYEazpG6FjvZt+rZE1p1LC9xDpn3ZlZyEB\n18tJsBhnCZtvOHBzm3SGTsfe8C83dTSVTdgsvLYCXHcb4Xy537l0fp5kflElNMeq\nbACQu7GJcDd75JcvypYTPqKu92wPr8JlToHp/wVY0q4RcK76fCFN5kgenLyySFCE\nABMcLb6NAgMBAAECggEAD5Fb5HfsxFS9/53zGgGj/behfqTkSCWyix6UKqv+Giew\n4Pym1clEOHYLT+tVkQ+fHJxemwQ3b2ViKDV2KKu+93iFEkBbgtRPiYGCWposhzN2\nT4LsXR7DULaO9stZREsG1iW49irIPzFShsPCFyP8VZVtYJawYkhR6DZRe6lcO5jr\nG4pWXSL+UwxV+Gd98OWiN2SyxFgpWEpqrOeS77W7d/knMGYvhIqAnGxmAYjH2cp/\naPDjsdjtqEDIOZuqENc/WEn3rEM47jl3p6rRp/C6BYavaQbpCP04NRuruJbOHwT+\n4/ac3pkmIqkVjG17cXGgli/imRiOnq+Z+PkOmW8SYQKBgQD3MmHizBawu9ZLXWWC\nx//jsWWr4iNln7J2i07zSwGn4sZOSiaFx+PJOt4Q+2Ai1T7r0iW0UaPwUx1qNH+R\nHfCIrEbvtfLEFaQTBi37oH3DEiiwQssogY2/oimFd8yxNxZvoLU2EOJUmMU9bOLy\nqcaSSECJjNXONA9lbAfAU7JcYQKBgQDy93fIYNfSBxFyQk7wMRMy54qlFtpvBZ7T\n+aHqeizrp8R9wGY0gbbdjqMQoujIfZCeiS8jJnRibFyWpUBbC4OR4cMoCc+EUnWe\ndI+mQ6Y7cyG9MSmtFgkU4X9DI+prYqLlAw6ZfyHMU3zoc8AtjR4qFwecC3Y2KiWD\nHVNBMm7xrQKBgCt7aUyDqdocsG1BWIHQvGpI4iGB/cf6d2Hyz0hsgTYO5eMPmAcg\nSikzeaxzC04VRKQmqws08Sls9VehNG9KXO0toKy5zKJBTEMsaxo/+N8/anjWxvWx\nFEYJOFSJ5i+mCQRJuJZyEd3foZJUfPdCdfN1UiTf6RwEfFDS1+o0zsMBAoGBAN7V\nC+ygtQ+RH/UUz2UG/T6wkL28afVsyDBNQKzWBKDUqydR7+q0FMy6Zt95KdnHH33m\n/25TdGZYT8pyIMXfl3mR/vSXmtUW83yyFpU8chcQDp9/mWN/VDDsZ1VieTqnqhIz\nbY5lxM+qumJO1rBwPnwHxxjcgjxHB0Rq/tJKuOm5AoGAKM6Lz74Quvv9D+tXpqWb\nxvXzOFF8kJhT12G//u+YRqHJTIGgRknsodl+NxjcJ6DedJl456BQJ5ZzsfEYOtbf\nxzJD+Dm0y1EseBb7zxE/YG7/MkYq6+scxFBv0EUkDfPIzH2+uM2NRhuFUFxbi5iE\nSgEbPGUPAU1Djyn2ZeVkx3U=\n-----END PRIVATE KEY-----\n",
  "client_email": "cloudvision@quantum-ether-381103.iam.gserviceaccount.com",
  "client_id": "118346908876949479554",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/cloudvision%40quantum-ether-381103.iam.gserviceaccount.com"
};

            // 서버로 데이터를 전송하여 감정 분석 결과를 받아옵니다.
          $.ajax({
                type: 'POST',
                url: 'https://vision.googleapis.com/v1/images:annotate?key=api_key',
                data: JSON.stringify({
                    requests: [
                        {
                            image: {
                                content: dataURL.split(',')[1]
                            },
                            features: [
                                {
                                    type: 'FACE_DETECTION',
                                    maxResults: 1
                                }
                            ]
                        }
                    ]
                }),
               contentType: 'application/json',
                dataType: 'json',
                success: function (response) {
                    // 감정 분석 결과를 출력합니다.
                    const emotion = response.choices[0].text;
                    showEmotionResult(emotion);
                },
                error: function (xhr, status, error) {
                    console.error('감정 분석을 실패했습니다:', error);
                }
            });
        }

        // 일정 간격으로 비디오 프레임을 캡처하고 감정 분석 결과를 받아오도록 설정합니다.
        setInterval(captureFrameAndDetectEmotion, 3000);
    </script>
</body>
</html>
